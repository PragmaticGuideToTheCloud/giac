baseDir: examples/api-microservices-iac/
cfg:
  templatesDir: /Users/gajdaw/pgttc/giac/src/../templates/
  nunjucks:
    autoescape: false
    tags:
      variableStart: <<<
      variableEnd: '>>>'
      blockStart: <%
      blockEnd: '%>'
    dev: false
    throwOnUndefined: false
    trimBlocks: false
    lstripBlocks: false
  filenameConvertions:
    gitignore: .gitignore
    dockerignore: .dockerignore
    gitkeep: .gitkeep
iterations:
  - __VPC_NAME__: dev
    __ENV_NAME__: dev1
files:
  - src: files/auth/Makefile
    dest: auth/Makefile
  - src: files/helm/deploy.sh
    dest: helm/__VPC_NAME__/__ENV_NAME__/deploy.sh
  - src: files/helm/values.yaml
    dest: helm/__VPC_NAME__/__ENV_NAME__/values.yaml
  - src: files/README.md
    dest: README.md
  - src: files/giac-doc.md
    dest: giac-doc.md
  - src: terragrunt/terragrunt.hcl
    dest: terragrunt/terragrunt.hcl
  - src: files/gitignore
    dest: gitignore
  - src: files/docker/dockerfiles/traefik/traefik.Dockerfile
    dest: docker/build/traefik.Dockerfile
  - src: files/docker/dockerfiles/traefik/traefik.toml
    dest: docker/build/traefik.toml
  - src: files/docker/test/docker-compose-traefik.yml
    dest: docker/test/docker-compose.yml
  - src: files/docker/dockerfiles/node/node-frontend.Dockerfile
    dest: docker/build/frontend.Dockerfile
  - src: files/docker/dockerfiles/python/python.Dockerfile
    dest: docker/build/backend-django.Dockerfile
  - src: files/docker/dockerfiles/java/java.Dockerfile
    dest: docker/build/backend-java.Dockerfile
  - src: files/docker/dockerfiles/node/node-backend.Dockerfile
    dest: docker/build/backend-node.Dockerfile
  - src: files/docker/dockerfiles/ruby/sinatra.Dockerfile
    dest: docker/build/backend-ruby.Dockerfile
  - src: files/docker/dockerfiles/php/fpm.Dockerfile
    dest: docker/build/fpm.Dockerfile
  - src: files/docker/dockerfiles/php/nginx/nginx.Dockerfile
    dest: docker/build/backend-symfony.Dockerfile
  - src: files/docker/dockerfiles/php/nginx/default.conf
    dest: docker/build/default.conf
  - src: files/docker/build/gitignore
    dest: docker/build/gitignore
  - src: files/docker/build/dockerignore
    dest: docker/build/dockerignore
  - src: files/docker/test/env
    dest: docker/test/.env
  - src: files/docker/build/Makefile
    dest: docker/build/Makefile
dirs:
  - src: tests
    dest: tests
  - src: helm-charts/helm-chart-basic
    dest: helm-chart
  - src: terragrunt/vpc
    dest: terragrunt/vpc
  - src: terragrunt/gke
    dest: terragrunt/gke
  - src: terragrunt/gsa
    dest: terragrunt/gsa
params:
  dockerComposeServiceNaming: long
  name: api-microservices
  description: 'API / Microservices / Java, Node, PHP, Python, Ruby'
  app_repo: 'git@github.com:PragmaticGuideToTheCloud/api-microservices.git'
  provider:
    gcp:
      project_id: gcp_project_id_12345
      envs:
        - dev/dev1
      vpc:
        boilerplate: >-
          git::ssh://git@github.com/PragmaticGuideToTheCloud/gcp-cloud-boilerplate.git//terraform/vpc
      gke:
        boilerplate: >-
          git::ssh://git@github.com/PragmaticGuideToTheCloud/gcp-cloud-boilerplate.git//terraform/gke-public-plane
      gsa:
        boilerplate: >-
          git::ssh://git@github.com/PragmaticGuideToTheCloud/gcp-cloud-boilerplate.git//terraform/gsa
      autoZone: false
  services:
    fpm:
      type: ClusterIP
      targetPort: 9000
      port: 9000
      srcCodePath: /backend-symfony
    backend-django:
      url: /api/writer/
      srcCodePath: /backend-django
      withTraefik: true
    backend-java:
      url: /api/poem/
      srcCodePath: /backend-java
      withTraefik: true
    backend-node:
      url: /api/song/
      srcCodePath: /backend-node
      withTraefik: true
    backend-ruby:
      url: /api/proverb/
      srcCodePath: /backend-ruby
      withTraefik: true
    backend-symfony:
      url: /api/quotation/
      srcCodePath: /backend-symfony
      withTraefik: true
    frontend:
      url: /
      srcCodePath: /frontend
      withTraefik: true
  container_registry: eu.gcr.io
  terraform:
    - vpc
    - gke
    - gsa
  ansibleBoilerplateUrl: 'git@github.com:PragmaticGuideToTheCloud/gcp-cloud-boilerplate.git'
  containers:
    - name: traefik
      srcCodePath: ''
    - name: backend-django
      srcCodePath: /backend-django
    - name: backend-java
      srcCodePath: /backend-java
    - name: backend-node
      srcCodePath: /backend-node
    - name: backend-ruby
      srcCodePath: /backend-ruby
    - name: backend-symfony
      srcCodePath: /backend-symfony
    - name: fpm
      srcCodePath: /backend-symfony
    - name: frontend
      srcCodePath: /frontend
  dockerServices:
    - name: traefik
      nodePort: 1
      url: ''
      type: NodePort
      excludeFromHelm: true
      dockerComposeServiceName: api-microservices-traefik
    - name: fpm
      nodePort: 32767
      url: ''
      type: ClusterIP
      targetPort: 9000
      port: 9000
      srcCodePath: /backend-symfony
      dockerComposeServiceName: api-microservices-fpm
    - name: frontend
      nodePort: 32766
      url: /
      type: NodePort
      srcCodePath: /frontend
      withTraefik: true
      dockerComposeServiceName: api-microservices-frontend
    - name: backend-java
      nodePort: 32765
      url: /api/poem/
      type: NodePort
      srcCodePath: /backend-java
      withTraefik: true
      dockerComposeServiceName: api-microservices-backend-java
    - name: backend-ruby
      nodePort: 32764
      url: /api/proverb/
      type: NodePort
      srcCodePath: /backend-ruby
      withTraefik: true
      dockerComposeServiceName: api-microservices-backend-ruby
    - name: backend-symfony
      nodePort: 32763
      url: /api/quotation/
      type: NodePort
      srcCodePath: /backend-symfony
      withTraefik: true
      dockerComposeServiceName: api-microservices-backend-symfony
    - name: backend-node
      nodePort: 32762
      url: /api/song/
      type: NodePort
      srcCodePath: /backend-node
      withTraefik: true
      dockerComposeServiceName: api-microservices-backend-node
    - name: backend-django
      nodePort: 32761
      url: /api/writer/
      type: NodePort
      srcCodePath: /backend-django
      withTraefik: true
      dockerComposeServiceName: api-microservices-backend-django
  helmServices:
    - name: fpm
      nodePort: 32767
      url: ''
      type: ClusterIP
      targetPort: 9000
      port: 9000
      srcCodePath: /backend-symfony
      dockerComposeServiceName: api-microservices-fpm
    - name: frontend
      nodePort: 32766
      url: /
      type: NodePort
      srcCodePath: /frontend
      withTraefik: true
      dockerComposeServiceName: api-microservices-frontend
    - name: backend-java
      nodePort: 32765
      url: /api/poem/
      type: NodePort
      srcCodePath: /backend-java
      withTraefik: true
      dockerComposeServiceName: api-microservices-backend-java
    - name: backend-ruby
      nodePort: 32764
      url: /api/proverb/
      type: NodePort
      srcCodePath: /backend-ruby
      withTraefik: true
      dockerComposeServiceName: api-microservices-backend-ruby
    - name: backend-symfony
      nodePort: 32763
      url: /api/quotation/
      type: NodePort
      srcCodePath: /backend-symfony
      withTraefik: true
      dockerComposeServiceName: api-microservices-backend-symfony
    - name: backend-node
      nodePort: 32762
      url: /api/song/
      type: NodePort
      srcCodePath: /backend-node
      withTraefik: true
      dockerComposeServiceName: api-microservices-backend-node
    - name: backend-django
      nodePort: 32761
      url: /api/writer/
      type: NodePort
      srcCodePath: /backend-django
      withTraefik: true
      dockerComposeServiceName: api-microservices-backend-django
